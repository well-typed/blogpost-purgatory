<html><head><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>Usage of C&#10132;Haskell</title><link rel="stylesheet" type="text/css" href="c2hs.css"><meta name="generator" content="DocBook XSL Stylesheets Vsnapshot"><link rel="home" href="index.html" title="The Binding Generator C&#10132;Haskell"><link rel="up" href="index.html" title="The Binding Generator C&#10132;Haskell"><link rel="prev" href="index.html" title="The Binding Generator C&#10132;Haskell"><link rel="next" href="implementing.html" title="Implementation of Haskell Binding Modules"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Usage of C&#10132;Haskell</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="index.html">Prev</a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="implementing.html">Next</a></td></tr></table><hr></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="usage"></a>Usage of C&#10132;Haskell</h2></div></div></div><p>
  Let's have a brief look at how to call the tool and how to use the generated
  interfaces.
  </p><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="idm46"></a>Usage of <span class="command"><strong>c2hs</strong></span></h3></div></div></div><p>
    C&#10132;Haskell is implemented by the executable <span class="command"><strong>c2hs</strong></span>. The simplest form of usage
    is

</p><pre class="screen">
c2hs <em class="replaceable"><code>Lib</code></em><code class="literal">.chs</code>
</pre><p>

    where <em class="replaceable"><code>Lib</code></em><code class="literal">.chs</code> is the Haskell
    binding module defining the Haskell interface to a C library together with
    the required marshalling code. If <span class="command"><strong>c2hs</strong></span> is invoked in this manner, the
    binding module must contain a cpp <code class="literal">#include</code> directive to
    determine the C-side interface of the library. Alternatively, a C header
    file can be specified on the command line, as in

</p><pre class="screen">
c2hs <em class="replaceable"><code>lib</code></em><code class="literal">.h </code><em class="replaceable"><code>Lib</code></em><code class="literal">.chs</code>
</pre><p>

    However, the latter option is only preserved for backwards compatibility and
    not recommended.  If no errors occur, <span class="command"><strong>c2hs</strong></span> generates three files:
    </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
        a pure Haskell module <em class="replaceable"><code>Lib</code></em><code class="literal">.hs</code>,
        which implements the Haskell API of the library
        </p></li><li class="listitem"><p>
         a C header file <em class="replaceable"><code>Lib</code></em><code class="literal">.h</code>
         which some Haskell systems need to compile the generated Haskell code.
        </p></li><li class="listitem"><p>
        a <span class="command"><strong>c2hs</strong></span> interface file
        <em class="replaceable"><code>Lib</code></em><code class="literal">.chi</code> that is used by
        other binding modules that import
        <em class="replaceable"><code>Lib</code></em><code class="literal">.hs</code> using an import
        hook (see <a class="xref" href="implementing.html#import" title="Import Hooks">the section called &#8220;Import Hooks&#8221;</a>the section on import hooks for details).
        </p></li></ol></div><p>
    </p><p>
    The executable <span class="command"><strong>c2hs</strong></span> has a couple more options:
</p><pre class="screen">
Usage: c2hs [ option... ] [header-file] binding-file

  -C CPPOPTS   --cppopts=CPPOPTS    pass CPPOPTS to the C preprocessor
  -c CPP       --cpp=CPP            use executable CPP to invoke C preprocessor
  -d TYPE      --dump=TYPE          dump internal information (for debugging)
  -h, -?       --help               brief help (the present message)
  -i INCLUDE   --include=INCLUDE    include paths for .chi files
  -k           --keep               keep pre-processed C header
  -l           --copy-library       copy `C2HS' library module in
  -o FILE      --output=FILE        output result to FILE (should end in .hs)
  -p PLATFORM  --platform=PLATFORM  platform to use for cross compilation
  -t PATH      --output-dir=PATH    place generated files in PATH
  -v           --version            show version information
               --numeric-version    show version number

The header file must be a C header file matching the given binding file.
The dump TYPE can be
  trace   -- trace compiler phases
  genbind -- trace binding generation
  ctrav   -- trace C declaration traversal
  chs     -- dump the binding file (adds `.dump' to the name)
PLATFORM can be x86_64-linux, i686-linux, m68k-palmos
</pre><p>

    The most useful of these is probably <code class="literal">--cppopts=</code> (or
    <code class="literal">-C</code>).  If the C header file needs any special options
    (like <code class="literal">-D</code> or <code class="literal">-I</code>) to go through the C
    pre-processor, here is the place to pass them.  A call may look like this:

</p><pre class="screen">
c2hs --cppopts='-I/some/obscure/dir' --cppopts=-DEXTRA' <em class="replaceable"><code>Lib</code></em>.chs
</pre><p>

    If you have more than one option that you want to pass to the pre-processor
    it is best to use multiple <code class="literal">--cppopts=</code> flags. That way
    there is no need to worry about quoting.
    </p><p>
    Often, <em class="replaceable"><code>lib</code></em><code class="literal">.h</code> will not be in
    the current directory, but in one of the header file directories. <span class="command"><strong>c2hs</strong></span>
    leaves locating the header file to the standard C preprocessor, which
    usually looks in two places for the header: first, in the standard include
    directory of the used system, this is usually <code class="filename">/usr/include</code> and
    <code class="filename">/usr/local/include</code>; and second, it will look in every directory
    that is mentioned in a <code class="literal">-IDIR</code> option passed to the
    pre-processor via <code class="literal">--cppopts</code>.
    </p><p>
    If the compiled binding module contains import hooks, C&#10132;Haskell needs to
    find the <code class="literal">.chi</code> (C&#10132;Haskell interface files) produced while compiling
    the corresponding binding modules.  By default, they will be searched for in
    the current working directory.  If they are located elsewhere, the
    <code class="literal">--include=<em class="replaceable"><code>INCLUDE</code></em></code> option has
    to be used to indicate the location, where
    <em class="replaceable"><code>INCLUDE</code></em> is a colon-separated list of
    directories.  Multiple such options are admissible.  Paths specified later
    are searched first.
    </p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="idm104"></a>Compilation of a Generated Haskell API</h3></div></div></div><p>
    C&#10132;Haskell comes with a marshalling library, called <code class="literal">C2HS</code>,
    which needs to be explicitly imported into Haskell binding modules.  The
    library contains functions that users might use explicitly, but also
    functions that C&#10132;Haskell will generate for some classes of bindings.  The
    library takes the form of a single Haskell module, which <span class="command"><strong>c2hs</strong></span> places in
    the same directory as the generated binding whenever it is given the
    <code class="literal">--copy-library</code> (or <code class="literal">-l</code>) option.
    </p></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="index.html">Prev</a> </td><td width="20%" align="center"> </td><td width="40%" align="right"> <a accesskey="n" href="implementing.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">The Binding Generator C&#10132;Haskell </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> Implementation of Haskell Binding Modules</td></tr></table></div></body></html>
